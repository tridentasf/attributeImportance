{
    "contents" : "\ngetAttributeImportance <- function(attrs, chips) {\nst <- data.frame(attrs, chips)\nnames(st)<-c(\"attributes\",\"chips\")\n\n#format data into [comp1, comp2, chips1, chips2]\nattr_split<-strsplit(as.character(st$attributes), \",\")\nchip_split<-strsplit(as.character(st$chips), \",\")\nmax_col=max(unlist(lapply(attr_split,length),recursive=TRUE))\n\nadd_list <- function (x,max_col){\n  u_l <- unlist(x)\n  l<-length(unlist(x))\n  pad_col = max_col - l\n  r_l <- c(u_l, rep(\"NA\",pad_col))\n  return(r_l)\n}\n\nattrList<-lapply(attr_split,add_list,max_col)\nchipList<-lapply(chip_split,add_list,max_col)\n\nattr_matrix<-data.frame(matrix(unlist(attrList,recursive=TRUE),nrow=NROW(st),byrow=T),stringsAsFactors=FALSE)\nanchor_matrix<-data.frame(matrix(0,nrow=NROW(st),byrow=T),stringsAsFactors=FALSE)\nchip_matrix<-data.frame(matrix(unlist(chipList,recursive=TRUE),nrow=NROW(st),byrow=T),stringsAsFactors=FALSE)\n\ndf<-cbind(attr_matrix,chip_matrix,anchor_matrix,anchor_matrix)\nnames(df)[1] <- \"comp1\"\nnames(df)[2] <- \"comp2\"\nnames(df)[3] <- \"chips1\"\nnames(df)[4] <- \"chips2\"\nnames(df)[5] <- \"anch1\"\nnames(df)[6] <- \"anch2\"\n\n#change 11->10.5 and 0->0.5\ndf$chips1[df$chips1==\"11\"]<-\"10.5\";\ndf$chips2[df$chips2==\"11\"]<-\"10.5\";\ndf$chips1[df$chips1==\"0\"]<-\"0.5\";\ndf$chips2[df$chips2==\"0\"]<-\"0.5\";\ndf <- transform(df, chips1=as.numeric(chips1))\ndf <- transform(df, chips2=as.numeric(chips2))\ndf <- transform(df, anch1=as.numeric(anch1))\ndf <- transform(df, anch2=as.numeric(anch2))\n\n\n#comparison 1 dataframe\ncomp1df = data.frame(df$comp1,df$chips1,stringsAsFactors=FALSE);\nnames(comp1df)[1] <- \"attr\"\nnames(comp1df)[2] <- \"chips\"\n\n#comparison 2 dataframe\ncomp2df = data.frame(df$comp2,df$chips2,stringsAsFactors=FALSE);\nnames(comp2df)[1] <- \"attr\"\nnames(comp2df)[2] <- \"chips\"\n\n#merge comps and make sure chips is numeric\nattrdf <- rbind(comp1df, comp2df)\nattrdf <- transform(attrdf, chips=as.numeric(chips))\n\n#sum chips per attribute and sort\naggrdf <- aggregate(attrdf$chips, by=list(attr=attrdf$attr), FUN=sum)\nnames(aggrdf)[2] <- \"totalchips\"\nsorteddf <- aggrdf[with(aggrdf, order(-totalchips)),]\n\n#replace anchor attribute with log(100)=2\ndf$anch1[df$comp1==sorteddf[1,1]]<-2\ndf$anch2[df$comp2==sorteddf[1,1]]<-2\n\n#calculate Y log(chips1)-log(chips2)\nydf = data.frame(data.frame(log(df$chips1, 10)) - data.frame(log(df$chips2, 10)))\ndf <- cbind(df, ydf);\nnames(df)[7] <- \"y\"\ndf$y[df$anch1==2]<-df$y[df$anch1==2]-2\ndf$y[df$anch2==2]<-df$y[df$anch2==2]+2\n\n#form X data frame\nxdf1 = data.frame(df$comp1, df$comp1, df$comp1, df$comp1, df$comp1, stringsAsFactors=FALSE);\nnames(xdf1) <- sorteddf[2:nrow(sorteddf),1]\nxdf1[1][xdf1[1]!=names(xdf1)[1]]<-0;\nxdf1[2][xdf1[2]!=names(xdf1)[2]]<-0;\nxdf1[3][xdf1[3]!=names(xdf1)[3]]<-0;\nxdf1[4][xdf1[4]!=names(xdf1)[4]]<-0;\nxdf1[5][xdf1[5]!=names(xdf1)[5]]<-0;\nxdf1[1][xdf1[1]!=0]<-1;\nxdf1[2][xdf1[2]!=0]<-1;\nxdf1[3][xdf1[3]!=0]<-1;\nxdf1[4][xdf1[4]!=0]<-1;\nxdf1[5][xdf1[5]!=0]<-1;\nxdf1=sapply(xdf1, as.numeric)\nxdf2 = data.frame(df$comp2, df$comp2, df$comp2, df$comp2, df$comp2, stringsAsFactors=FALSE);\nnames(xdf2) <- sorteddf[2:nrow(sorteddf),1]\nxdf2[1][xdf2[1]!=names(xdf2)[1]]<-0;\nxdf2[2][xdf2[2]!=names(xdf2)[2]]<-0;\nxdf2[3][xdf2[3]!=names(xdf2)[3]]<-0;\nxdf2[4][xdf2[4]!=names(xdf2)[4]]<-0;\nxdf2[5][xdf2[5]!=names(xdf2)[5]]<-0;\nxdf2[1][xdf2[1]!=0]<--1;\nxdf2[2][xdf2[2]!=0]<--1;\nxdf2[3][xdf2[3]!=0]<--1;\nxdf2[4][xdf2[4]!=0]<--1;\nxdf2[5][xdf2[5]!=0]<--1;\nxdf2=sapply(xdf2, as.numeric)\nxdf=xdf1+xdf2\n\n#form regression data frame and regress\nregdata <- data.frame(xdf, df$y)\nxvars <- names(regdata)\nnames(xvars) <- c(\"x1\",\"x2\",\"x3\",\"x4\",\"x5\",\"y\")\nnames(regdata) <- c(\"x1\",\"x2\",\"x3\",\"x4\",\"x5\",\"y\")\nfit <- lm(formula = y ~ -1+x1+x2+x3+x4+x5, data=regdata)\ncoef <- coefficients(fit)\nnames(coef) <- xvars[1:5]\ncoef$missingattr<-2\nnames(coef)[6] <- sorteddf[1,1]\ncoefdf <- 10^(data.frame(coef, stringsAsFactors=FALSE))\n\n#final attribute importance\nattrImportance <- coefdf / sum(coefdf) * 100\n\nreturn(attrImportance)\n}",
    "created" : 1430941174177.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2290775749",
    "id" : "15823D6B",
    "lastKnownWriteTime" : 1430941291,
    "path" : "~/attributeImportance/R/attributeImportance.R",
    "project_path" : "R/attributeImportance.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}